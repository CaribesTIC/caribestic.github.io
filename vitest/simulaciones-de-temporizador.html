<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Simulaciones de Temporizador | Vue(tdd)</title>
    <meta name="description" content="TDD con Vue 3.">
    <link rel="stylesheet" href="/vue-tdd/assets/style.c3210e46.css">
    <link rel="modulepreload" href="/vue-tdd/assets/app.6d5336e7.js">
    <link rel="modulepreload" href="/vue-tdd/assets/vitest_simulaciones-de-temporizador.md.d115037b.lean.js">
    
    <meta name="twitter:title" content="Simulaciones de Temporizador | Vue(tdd)">
  <meta property="og:title" content="Simulaciones de Temporizador | Vue(tdd)">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/vue-tdd/" aria-label="Vue(tdd), back to home" data-v-675d8756 data-v-cc01ef16><img class="logo" src="/vue-tdd/logo.png" alt="Logo" data-v-cc01ef16> Vue(tdd)</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/vue-tdd/" data-v-b8818f8c>Home <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/vue-tdd/comenzar/tdd" data-v-b8818f8c>Guide <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/CaribesTIC/vue-tdd" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/vue-tdd/" data-v-b8818f8c>Home <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/vue-tdd/comenzar/tdd" data-v-b8818f8c>Guide <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/CaribesTIC/vue-tdd" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><p class="sidebar-link-item">Comenzar</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/comenzar/tdd">Desarrollo Dirigido por Pruebas</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/comenzar/pruebas-unitarias">Pruebas Unitarias</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Vitest</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vitest/porque-vitest">¿Por qué Vitest?</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vitest/entorno-de-prueba">Entorno de Prueba</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vitest/usando-comparadores">Usando Comparadores</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vitest/configuracion-y-desmontaje">Configuración y Desmontaje</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vitest/filtrando-pruebas">Filtrando Pruebas</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vitest/probando-codigo-asincrono">Probando Código Asíncrono</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vitest/un-ejemplo-asincrono">Un Ejemplo Asíncrono</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vitest/funciones-simuladas">Funciones Simuladas</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vitest/simulaciones">Simulaciones</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/vue-tdd/vitest/simulaciones-de-temporizador">Simulaciones de Temporizador</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#habilitar-temporizadores-falsos">Habilitar Temporizadores Falsos</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#ejecutar-todos-los-temporizadores">Ejecutar Todos los Temporizadores</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#ejecutar-temporizadores-pendientes">Ejecutar Temporizadores Pendientes</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#temporizadores-de-avance-por-tiempo">Temporizadores de avance por tiempo</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#falsificacion-selectiva">Falsificación Selectiva</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vitest/simulaciones-de-clase-es6">Simulaciones de Clase ES6</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Vue Tests Utils</p><ul class="sidebar-links"><li class="sidebar-link"><p class="sidebar-link-item">Esencial</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtu/esencial/intro">¿Qué es Vue Test Utils?</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtu/esencial/entorno-de-prueba">Entorno de Prueba</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtu/esencial/un-curso-acelerado">Un Curso Acelerado</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtu/esencial/renderizado-condicional">Renderizado Condicional</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtu/esencial/manejo-de-eventos">Probando el Manejo de Eventos</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtu/esencial/formularios">Probando Formularios</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtu/esencial/pasando-datos-a-componentes">Pasando Datos a Componentes</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtu/esencial/escribir-componentes-que-sean faciles-de-probar">Escribir componentes que sean fáciles de probar</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Vue Test Utils en-profundidad</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtu/vue-test-utils-en-profundidad/ranuras">Ranuras</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtu/vue-test-utils-en-profundidad/comportamiento-asincrono">Comportamiento Asíncrono</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtu/vue-test-utils-en-profundidad/solicitudes-http">Realizando Solicitudes HTTP</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtu/vue-test-utils-en-profundidad/transiciones">Transiciones</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtu/vue-test-utils-en-profundidad/instancia-de-componente">Instancia de Componente</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtu/vue-test-utils-en-profundidad/reusabilidad-y-composicion">Reusabilidad &amp; Composición</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtu/vue-test-utils-en-profundidad/probando-vuex">Probando Vuex</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtu/vue-test-utils-en-profundidad/un-poco-mas-sobre-vuex">Un poco más sobre Vuex</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtu/vue-test-utils-en-profundidad/probando-vue-router">Probando Vue Router</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtu/vue-test-utils-en-profundidad/probando-teleport">Probando Teleport</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtu/vue-test-utils-en-profundidad/talones-y-montaje-superficial">Talones y Montaje Superficial</a><!----></li></ul></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Vue Testing Handbook</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vth/renderizar-componentes">Renderizar Componentes</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vth/probando-propiedades">Probando Propiedades</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vth/propiedades-calculadas">Propiedades Calculadas</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vth/simulando-la-entrada-del-usuario">Simulando la entrada del usuario</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vth/probando-eventos-emitidos">Probando Eventos Emitidos</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vth/simulando-objetos-globales">Simulando Objetos Globales</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vth/talonando-componentes">Talonando Componentes</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vth/encontrando-elementos-y-componentes">Encontrando elementos y componentes</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vth/probando-vuex">Probando Vuex</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vth/vuex-mutaciones">Vuex Mutaciones</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vth/vuex-acciones">Vuex Accciones</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vth/vuex-captadores">Vuex Captadores</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vth/probando-vuex-en-componentes">Probando Vuex en componentes - estados y captadores</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vth/probando-vuex-en-componentes-mutaciones-y-acciones">Probando Vuex en componentes - mutaciones y acciones</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vth/vue-router">Vue Router</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vth/api-de-composicion">API de Composición</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vth/reduciendo-repetitividad-en-las-pruebas">Reduciendo Repetitividad en las Pruebas</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Vue Testing Library</p><ul class="sidebar-links"><li class="sidebar-link"><p class="sidebar-link-item">Documentación</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtl/documentacion/intro">¿Qué es Testing Library?</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtl/documentacion/guias-de-principios">Guías de Principios</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtl/documentacion/intro-v">¿Qué es Vue Testing Library?</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtl/documentacion/ejemplos">Ejemplos</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Prueba Simples y Completas</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtl/psyc/consultas-dom">Consultas DOM</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtl/psyc/filosofia">Filosofía</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtl/psyc/getby-queryby-findby">getBy, queryBy y findBy</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtl/psyc/fireevent-waitfor">fireEvent y waitFor</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtl/psyc/findby-para-consultas-asincronicas">findBy para consultas asincrónicas</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtl/psyc/trabajar-con-formularios">Trabajar con Formularios</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtl/psyc/enviar-formularios-y-emitir-eventos">Enviar formularios y emitir eventos</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Diseño Dirigido por Pruebas</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtl/ddp/intro">Introducción</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtl/ddp/patrones-para-probar-accesorios">Patrones para Probar Accesorios</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/vtl/ddp/emitir-eventos">Emitir Eventos</a><!----></li></ul></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Pinia</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-tdd/pinia/probando-pinia">Probando Pinia</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="simulaciones-de-temporizador" tabindex="-1">Simulaciones de Temporizador <a class="header-anchor" href="#simulaciones-de-temporizador" aria-hidden="true">#</a></h1><p>Las funciones de temporizador nativas (es decir, <code>setTimeout()</code>, <code>setInterval()</code>, <code>clearTimeout()</code>, <code>clearInterval()</code>) son menos que ideales para un entorno de prueba, ya que dependen del tiempo real para transcurrir. Vitest puede intercambiar temporizadores con funciones que te permiten controlar el paso del tiempo. <a href="https://www.youtube.com/watch?v=QZoJ2Pt27BY" target="_blank" rel="noopener noreferrer">¡Gran Scott!</a></p><div class="info custom-block"><p class="custom-block-title">Información</p><p>Consulte también la documentación de la <a href="https://vitest.dev/api/#vi-usefaketimers" target="_blank" rel="noopener noreferrer">API de temporizadores falsos</a>.</p></div><h2 id="habilitar-temporizadores-falsos" tabindex="-1">Habilitar Temporizadores Falsos <a class="header-anchor" href="#habilitar-temporizadores-falsos" aria-hidden="true">#</a></h2><p>En el siguiente ejemplo, habilitamos temporizadores falsos llamando a vi.useFakeTimers(). Esto reemplaza la implementación original de <code>setTimeout()</code> y otras funciones de temporizador. Los temporizadores se pueden restaurar a su comportamiento normal con <code>vi.useRealTimers()</code>.</p><div class="language-js"><pre><code><span class="token comment">// timerGame.js</span>
<span class="token keyword">const</span> <span class="token function-variable function">timerGame</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Ready....go!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Time&#39;s up -- stop!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> timerGame<span class="token punctuation">;</span>
</code></pre></div><div class="language-js"><pre><code><span class="token comment">// timerGame.spec.js</span>
<span class="token keyword">import</span> timerGame <span class="token keyword">from</span> <span class="token string">&#39;@/timerGame&#39;</span><span class="token punctuation">;</span>

vi<span class="token punctuation">.</span><span class="token function">useFakeTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;waits 1 second before ending the game&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  vi<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>global<span class="token punctuation">,</span> <span class="token string">&#39;setTimeout&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">timerGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>setTimeout<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>setTimeout<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenLastCalledWith</span><span class="token punctuation">(</span>expect<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span>Function<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="ejecutar-todos-los-temporizadores" tabindex="-1">Ejecutar Todos los Temporizadores <a class="header-anchor" href="#ejecutar-todos-los-temporizadores" aria-hidden="true">#</a></h2><p>Otra prueba que podríamos querer escribir para este módulo es una que afirme que la devolución de llamada se llama después de 1 segundo. Para hacer esto, vamos a usar las API de control de temporizador de Vitest para acelerar el tiempo justo en el medio de la prueba:</p><div class="language-js"><pre><code><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;calls the callback after 1 second&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  
  <span class="token keyword">const</span> callback <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">timerGame</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// At this point in time, the callback should not have been called yet</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Fast-forward until all timers have been executed</span>
  vi<span class="token punctuation">.</span><span class="token function">runAllTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Now our callback should have been called!</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="ejecutar-temporizadores-pendientes" tabindex="-1">Ejecutar Temporizadores Pendientes <a class="header-anchor" href="#ejecutar-temporizadores-pendientes" aria-hidden="true">#</a></h2><p>También hay escenarios en los que podría tener un temporizador recursivo, es decir, un temporizador que establece un nuevo temporizador en su propia devolución de llamada. Para estos, ejecutar todos los temporizadores sería un ciclo sin fin, lanzando el siguiente error: <em>&quot;Aborting after running 100000 timers, assuming an infinite loop!&quot;</em>.</p><p>Si ese es tu caso, usar <code>vi.runOnlyPendingTimers()</code> resolverá el problema:</p><div class="language-js"><pre><code><span class="token comment">// infiniteTimerGame.js</span>
<span class="token keyword">const</span> <span class="token function-variable function">infiniteTimerGame</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Ready....go!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Time&#39;s up! 10 seconds before the next game starts...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Schedule the next game in 10 seconds</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">infiniteTimerGame</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> infiniteTimerGame<span class="token punctuation">;</span>
</code></pre></div><div class="language-js"><pre><code><span class="token comment">// infiniteTimerGame.spec.js</span>
<span class="token keyword">import</span> infiniteTimerGame <span class="token keyword">from</span> <span class="token string">&#39;@/infiniteTimerGame&#39;</span><span class="token punctuation">;</span>

vi<span class="token punctuation">.</span><span class="token function">useFakeTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;infiniteTimerGame&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;schedules a 10-second timer after 1 second&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    vi<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>global<span class="token punctuation">,</span> <span class="token string">&#39;setTimeout&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> callback <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">infiniteTimerGame</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// At this point in time, there should have been a single call to</span>
    <span class="token comment">// setTimeout to schedule the end of the game in 1 second.</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>setTimeout<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>setTimeout<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenLastCalledWith</span><span class="token punctuation">(</span>expect<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span>Function<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Fast forward and exhaust only currently pending timers</span>
    <span class="token comment">// (but not any new timers that get created during that process)</span>
    vi<span class="token punctuation">.</span><span class="token function">runOnlyPendingTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// At this point, our 1-second timer should have fired its callback</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// And it should have created a new timer to start the game over in</span>
    <span class="token comment">// 10 seconds</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>setTimeout<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>setTimeout<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenLastCalledWith</span><span class="token punctuation">(</span>expect<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span>Function<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="temporizadores-de-avance-por-tiempo" tabindex="-1">Temporizadores de avance por tiempo <a class="header-anchor" href="#temporizadores-de-avance-por-tiempo" aria-hidden="true">#</a></h2><p>Otra posibilidad es usar <code>vi.advanceTimersByTime(msToRun)</code>. Cuando se llama a esta API, todos los temporizadores avanzan <code>msToRun</code> milisegundos. Se ejecutarán todas las &quot;macrotareas&quot; pendientes que se hayan puesto en cola a través de <code>setTimeout()</code> o <code>setInterval()</code>, y que se ejecutarían durante este período de tiempo. Además, si esas macrotareas programan nuevas macrotareas que se ejecutarían en el mismo período de tiempo, se ejecutarán hasta que no queden más macrotareas en la cola que deban ejecutarse en <code>msToRun</code> milisegundos.</p><div class="language-js"><pre><code><span class="token comment">// timerGame</span>
<span class="token keyword">const</span> <span class="token function-variable function">timerGame</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Ready....go!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Time&#39;s up -- stop!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> timerGame<span class="token punctuation">;</span>
</code></pre></div><div class="language-js"><pre><code><span class="token comment">// timerGame.spec.js</span>
<span class="token keyword">import</span> timerGame <span class="token keyword">from</span> <span class="token string">&#39;@/timerGame&#39;</span><span class="token punctuation">;</span>

vi<span class="token punctuation">.</span><span class="token function">useFakeTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;calls the callback after 1 second via advanceTimersByTime&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  
  <span class="token keyword">const</span> callback <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">timerGame</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// At this point in time, the callback should not have been called yet</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Fast-forward until all timers have been executed</span>
  vi<span class="token punctuation">.</span><span class="token function">advanceTimersByTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Now our callback should have been called!</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Por último, ocasionalmente puede ser útil en algunas pruebas poder borrar todos los temporizadores pendientes. Para esto, tenemos <code>vi.clearAllTimers()</code>.</p><h2 id="falsificacion-selectiva" tabindex="-1">Falsificación Selectiva <a class="header-anchor" href="#falsificacion-selectiva" aria-hidden="true">#</a></h2><p>A veces, su código puede requerir evitar sobrescribir la implementación original de una u otra API. Si ese es el caso, puede usar la opción <code>doNotFake</code>. Por ejemplo, así es como podría proporcionar una función simulada personalizada para <code>performance.mark()</code> en el entorno jsdom:</p><div class="language-js"><pre><code><span class="token comment">/**
 * @vitest-environment jsdom
 */</span>
 
<span class="token comment">// redefining readonly property of the performance object</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>performance<span class="token punctuation">,</span> <span class="token string">&quot;mark&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mockPerformanceMark <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>performance<span class="token punctuation">.</span>mark <span class="token operator">=</span> mockPerformanceMark<span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;allows mocking `performance.mark()`&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  vi<span class="token punctuation">.</span><span class="token function">useFakeTimers</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">doNotFake</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;performance&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>performance<span class="token punctuation">.</span>mark<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span>mockPerformanceMark<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-07c132fc><div class="edit" data-v-07c132fc><div class="edit-link" data-v-07c132fc data-v-1ed99556><!----></div></div><div class="updated" data-v-07c132fc><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/vue-tdd/vitest/simulaciones" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>Simulaciones</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/vue-tdd/vitest/simulaciones-de-clase-es6" data-v-38ede35f><span class="text" data-v-38ede35f>Simulaciones de Clase ES6</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"comenzar_pruebas-unitarias.md\":\"15068691\",\"comenzar_tdd.md\":\"c66f90bf\",\"index.md\":\"9891a602\",\"pinia_probando-pinia.md\":\"7d2d6848\",\"vitest_configuracion-y-desmontaje.md\":\"1b7531ea\",\"vitest_entorno-de-prueba.md\":\"9bcee370\",\"vitest_filtrando-pruebas.md\":\"8c9ec14b\",\"vitest_funciones-simuladas.md\":\"2b29d25b\",\"vitest_porque-vitest.md\":\"2d574df3\",\"vitest_probando-codigo-asincrono.md\":\"3c8d559d\",\"vitest_simulaciones-de-clase-es6.md\":\"6526d34f\",\"vitest_simulaciones-de-temporizador.md\":\"d115037b\",\"vitest_simulaciones.md\":\"5e63859f\",\"vitest_un-ejemplo-asincrono.md\":\"9f024ce2\",\"vitest_usando-comparadores.md\":\"6d632681\",\"vth_api-de-composicion.md\":\"84d61adf\",\"vth_encontrando-elementos-y-componentes.md\":\"a9417fa9\",\"vth_probando-eventos-emitidos.md\":\"3cdc637b\",\"vth_probando-propiedades.md\":\"7950130d\",\"vth_probando-vuex-en-componentes-mutaciones-y-acciones.md\":\"d7a9fee6\",\"vth_probando-vuex-en-componentes.md\":\"1b8a7399\",\"vth_probando-vuex.md\":\"a0f18739\",\"vth_propiedades-calculadas.md\":\"9a383892\",\"vth_reduciendo-repetitividad-en-las-pruebas.md\":\"92abdf29\",\"vth_renderizar-componentes.md\":\"cf590215\",\"vth_simulando-la-entrada-del-usuario.md\":\"c494df8c\",\"vth_simulando-objetos-globales.md\":\"65345f50\",\"vth_talonando-componentes.md\":\"265707fb\",\"vth_vue-router.md\":\"4d743cab\",\"vth_vuex-acciones.md\":\"64db279a\",\"vth_vuex-captadores.md\":\"d2c04e3f\",\"vth_vuex-mutaciones.md\":\"9080c662\",\"vtl_ddp_emitir-eventos.md\":\"69646f9a\",\"vtl_ddp_intro.md\":\"e9187474\",\"vtl_ddp_patrones-para-probar-accesorios.md\":\"ac11d951\",\"vtl_documentacion_ejemplos.md\":\"16cd8638\",\"vtl_documentacion_guias-de-principios.md\":\"671d0ee2\",\"vtl_documentacion_intro-v.md\":\"7fee074f\",\"vtl_documentacion_intro.md\":\"aba77760\",\"vtl_psyc_consultas-dom.md\":\"8e8f5f68\",\"vtl_psyc_enviar-formularios-y-emitir-eventos.md\":\"7ffc38b3\",\"vtl_psyc_filosofia.md\":\"8f98be55\",\"vtl_psyc_findby-para-consultas-asincronicas.md\":\"a4fa8658\",\"vtl_psyc_fireevent-waitfor.md\":\"62d3e533\",\"vtl_psyc_getby-queryby-findby.md\":\"7da9f67d\",\"vtl_psyc_trabajar-con-formularios.md\":\"e662f420\",\"vtu_esencial_entorno-de-prueba.md\":\"4c698965\",\"vtu_esencial_escribir-componentes-que-sean faciles-de-probar.md\":\"611ac1af\",\"vtu_esencial_formularios.md\":\"97b51baa\",\"vtu_esencial_intro.md\":\"2bc4d905\",\"vtu_esencial_manejo-de-eventos.md\":\"27b86fdf\",\"vtu_esencial_pasando-datos-a-componentes.md\":\"90a22fd8\",\"vtu_esencial_renderizado-condicional.md\":\"c73950b6\",\"vtu_esencial_un-curso-acelerado.md\":\"84516108\",\"vtu_vue-test-utils-en-profundidad_comportamiento-asincrono.md\":\"fe214edc\",\"vtu_vue-test-utils-en-profundidad_instancia-de-componente.md\":\"7556aefa\",\"vtu_vue-test-utils-en-profundidad_probando-teleport.md\":\"94c6a425\",\"vtu_vue-test-utils-en-profundidad_probando-vue-router.md\":\"0d75c7be\",\"vtu_vue-test-utils-en-profundidad_probando-vuex.md\":\"2b919933\",\"vtu_vue-test-utils-en-profundidad_ranuras.md\":\"ce1dca69\",\"vtu_vue-test-utils-en-profundidad_reusabilidad-y-composicion.md\":\"0e4d29c9\",\"vtu_vue-test-utils-en-profundidad_solicitudes-http.md\":\"dd9a9001\",\"vtu_vue-test-utils-en-profundidad_talones-y-montaje-superficial.md\":\"a9128da6\",\"vtu_vue-test-utils-en-profundidad_transiciones.md\":\"61789a8d\",\"vtu_vue-test-utils-en-profundidad_un-poco-mas-sobre-vuex.md\":\"de4f9e65\"}")</script>
    <script type="module" async src="/vue-tdd/assets/app.6d5336e7.js"></script>
    
  </body>
</html>