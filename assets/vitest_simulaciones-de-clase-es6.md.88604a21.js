import{_ as n,c as s,o as a,a as p}from"./app.bfee6243.js";const y='{"title":"Simulaciones de Clase ES","description":"","frontmatter":{},"headers":[{"level":2,"title":"Un Ejemplo de Clase ES6","slug":"un-ejemplo-de-clase-es6"},{"level":2,"title":"Limpiando entre pruebas","slug":"limpiando-entre-pruebas"},{"level":2,"title":"Espiando m\xE9todos de nuestra clase","slug":"espiando-metodos-de-nuestra-clase"},{"level":2,"title":"Ejemplo Completo","slug":"ejemplo-completo"}],"relativePath":"vitest/simulaciones-de-clase-es6.md"}',o={},t=p(`<h1 id="simulaciones-de-clase-es" tabindex="-1">Simulaciones de Clase ES <a class="header-anchor" href="#simulaciones-de-clase-es" aria-hidden="true">#</a></h1><p>Vitest se puede usar para burlarse de las clases de ES6 que se importan a los archivos que desea probar.</p><p>Las clases de ES6 son funciones constructoras con algo de az\xFAcar sint\xE1ctica. Por lo tanto, cualquier simulaci\xF3n de una clase ES6 debe ser una funci\xF3n o una clase ES6 real (que es, de nuevo, otra funci\xF3n). Entonces puedes burlarte de ellos usando <a href="./../vitest/funciones-simuladas.html">funciones simuladas</a>.</p><h2 id="un-ejemplo-de-clase-es6" tabindex="-1">Un Ejemplo de Clase ES6 <a class="header-anchor" href="#un-ejemplo-de-clase-es6" aria-hidden="true">#</a></h2><p>Usaremos un ejemplo artificial de una clase que reproduce archivos de sonido, <code>SoundPlayer</code>, y una clase de consumidor que usa esa clase, <code>SoundPlayerConsumer</code>. Simularemos <code>SoundPlayer</code> en nuestras pruebas para <code>SoundPlayerConsumer</code>.</p><div class="language-js"><pre><code><span class="token comment">// src/sound-player.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">SoundPlayer</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">&#39;bar&#39;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">playSoundFile</span><span class="token punctuation">(</span><span class="token parameter">fileName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Playing sound file &#39;</span> <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js"><pre><code><span class="token comment">// src/sound-player-consumer.js</span>
<span class="token keyword">import</span> SoundPlayer <span class="token keyword">from</span> <span class="token string">&#39;@/sound-player&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">SoundPlayerConsumer</span> <span class="token punctuation">{</span>  
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>soundPlayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoundPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">playSomethingCool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> coolSoundFileName <span class="token operator">=</span> <span class="token string">&#39;song.mp3&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>soundPlayer<span class="token punctuation">.</span><span class="token function">playSoundFile</span><span class="token punctuation">(</span>coolSoundFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>    
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="limpiando-entre-pruebas" tabindex="-1">Limpiando entre pruebas <a class="header-anchor" href="#limpiando-entre-pruebas" aria-hidden="true">#</a></h2><p>Para borrar el registro de llamadas a la funci\xF3n constructora simulada y sus m\xE9todos, llamamos a <a href="https://vitest.dev/api/#mockclear" target="_blank" rel="noopener noreferrer">mockClear()</a> en la funci\xF3n <code>beforeEach()</code>:</p><div class="language-js"><pre><code><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  SoundPlayer<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mockPlaySoundFile<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="espiando-metodos-de-nuestra-clase" tabindex="-1">Espiando m\xE9todos de nuestra clase <a class="header-anchor" href="#espiando-metodos-de-nuestra-clase" aria-hidden="true">#</a></h2><p>Nuestra clase simulada deber\xE1 proporcionar cualquier funci\xF3n miembro (<code>playSoundFile</code> en el ejemplo) que se llamar\xE1 durante nuestras pruebas, o de lo contrario obtendremos un error por llamar a una funci\xF3n que no existe. Pero probablemente tambi\xE9n querremos espiar las llamadas a esos m\xE9todos, para asegurarnos de que se hayan llamado con los par\xE1metros esperados.</p><p>Se crear\xE1 un nuevo objeto cada vez que se llame a la funci\xF3n constructora simulada durante las pruebas. Para espiar las llamadas a m\xE9todos en todos estos objetos, completamos <code>playSoundFile</code> con otra funci\xF3n simulada y almacenamos una referencia a esa misma funci\xF3n simulada en nuestro archivo de prueba, para que est\xE9 disponible durante las pruebas.</p><div class="language-js"><pre><code><span class="token comment">// tests/sound-player.spec.js</span>
<span class="token keyword">import</span> SoundPlayer <span class="token keyword">from</span> <span class="token string">&#39;@/sound-player&#39;</span><span class="token punctuation">;</span>
vi<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&#39;@/sound-player&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SoundPlayer is now a mock constructor</span>
<span class="token keyword">const</span> mockPlaySoundFile <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
SoundPlayer <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">playSoundFile</span><span class="token operator">:</span> mockPlaySoundFile<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>El equivalente simulado manual de esto ser\xEDa:</p><div class="language-js"><pre><code><span class="token comment">// src/__mocks__/sound-player.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> mockPlaySoundFile <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mock <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">playSoundFile</span><span class="token operator">:</span> mockPlaySoundFile<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> mock<span class="token punctuation">;</span>
<span class="token comment">// Import this named export into your test file</span>
</code></pre></div><p>El uso es similar a la funci\xF3n de f\xE1brica de m\xF3dulos, excepto que quedar\xE1 m\xE1s limpia su prueba. Recuerde que debe importar el m\xE9todo simulado a su archivo de prueba, ya que ya no est\xE1 definido all\xED. Use la ruta del m\xF3dulo original para esto; no incluya <code>__mocks__</code>.</p><h2 id="ejemplo-completo" tabindex="-1">Ejemplo Completo <a class="header-anchor" href="#ejemplo-completo" aria-hidden="true">#</a></h2><p>Aqu\xED hay un ejemplo completo que usa el par\xE1metro de f\xE1brica del m\xF3dulo para <code>vi.mock</code>:</p><div class="language-js"><pre><code><span class="token comment">// tests/sound-player-1.spec.js</span>
<span class="token keyword">import</span> SoundPlayer <span class="token keyword">from</span> <span class="token string">&#39;@/sound-player&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> SoundPlayerConsumer <span class="token keyword">from</span> <span class="token string">&#39;@/sound-player-consumer&#39;</span><span class="token punctuation">;</span>

vi<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&#39;@/sound-player&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SoundPlayer is now a mock constructor</span>
<span class="token keyword">const</span> mockPlaySoundFile <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
SoundPlayer <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">playSoundFile</span><span class="token operator">:</span> mockPlaySoundFile<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Clear all instances and calls to constructor and all methods:</span>
  SoundPlayer<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mockPlaySoundFile<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;We can check if the consumer called the class constructor&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> soundPlayerConsumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoundPlayerConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>SoundPlayer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;We can check if the consumer called a method on the class instance&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> soundPlayerConsumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoundPlayerConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> coolSoundFileName <span class="token operator">=</span> <span class="token string">&#39;song.mp3&#39;</span><span class="token punctuation">;</span>
  soundPlayerConsumer<span class="token punctuation">.</span><span class="token function">playSomethingCool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mockPlaySoundFile<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>coolSoundFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Finalmente, aqu\xED hay otro ejemplo completo que usa la simulaci\xF3n manual para <code>vi.mock</code>:</p><div class="language-js"><pre><code><span class="token comment">// tests/sound-player-2.spec.js</span>
<span class="token keyword">import</span> SoundPlayer<span class="token punctuation">,</span> <span class="token punctuation">{</span> mockPlaySoundFile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/sound-player&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> SoundPlayerConsumer <span class="token keyword">from</span> <span class="token string">&#39;@/sound-player-consumer&#39;</span><span class="token punctuation">;</span>
vi<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&#39;@/sound-player&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SoundPlayer is now a mock constructor</span>

<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  SoundPlayer<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mockPlaySoundFile<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;The consumer should be able to call new() on SoundPlayer&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> soundPlayerConsumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoundPlayerConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Ensure constructor created the object:</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>soundPlayerConsumer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;We can check if the consumer called the class constructor&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Show that mockClear() is working:</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>SoundPlayer<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> soundPlayerConsumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoundPlayerConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>SoundPlayer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;We can check if the consumer called a method on the class instance&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> soundPlayerConsumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoundPlayerConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> coolSoundFileName <span class="token operator">=</span> <span class="token string">&#39;song.mp3&#39;</span><span class="token punctuation">;</span>
  soundPlayerConsumer<span class="token punctuation">.</span><span class="token function">playSomethingCool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>mockPlaySoundFile<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span>coolSoundFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>`,22),e=[t];function c(u,l,i,k,r,d){return a(),s("div",null,e)}var f=n(o,[["render",c]]);export{y as __pageData,f as default};
