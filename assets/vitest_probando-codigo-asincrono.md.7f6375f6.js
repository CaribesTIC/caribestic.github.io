import{_ as n,c as a,o as s,a as t}from"./app.bbdf5da0.js";const f='{"title":"Probando C\xF3digo As\xEDncrono","description":"","frontmatter":{},"headers":[{"level":2,"title":"Devoluciones de llamada","slug":"devoluciones-de-llamada"},{"level":2,"title":"Promesas","slug":"promesas"},{"level":2,"title":".resuelve / .rechaza","slug":"resuelve-rechaza"},{"level":2,"title":"As\xEDncrono/Espera","slug":"asincrono-espera"}],"relativePath":"vitest/probando-codigo-asincrono.md"}',p={},e=t(`<h1 id="probando-codigo-asincrono" tabindex="-1">Probando C\xF3digo As\xEDncrono <a class="header-anchor" href="#probando-codigo-asincrono" aria-hidden="true">#</a></h1><p>Es com\xFAn en JavaScript que el c\xF3digo se ejecute de forma as\xEDncrona. Cuando tiene un c\xF3digo que se ejecuta de forma as\xEDncrona, Vitest necesita saber cu\xE1ndo se ha completado el c\xF3digo que est\xE1 probando, antes de poder pasar a otra prueba. Vitest tiene varias formas de manejar esto.</p><h2 id="devoluciones-de-llamada" tabindex="-1">Devoluciones de llamada <a class="header-anchor" href="#devoluciones-de-llamada" aria-hidden="true">#</a></h2><p>El patr\xF3n asincr\xF3nico m\xE1s com\xFAn son las devoluciones de llamada.</p><p>Supongamos que en nuestro <em>Servicio de Api</em> tenemos una funci\xF3n <code>fetchData(callback)</code> que obtiene algunos datos y llama a <code>callback(data)</code> cuando se completa. Deseamos probar que estos datos devueltos son la cadena <code>&#39;peanut butter&#39;</code>.</p><p>Ejemplo: <code>src/apiService/fetchData.js</code> :</p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Ready....go!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Time&#39;s up -- stop!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">&quot;peanut butter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>De forma predeterminada, las pruebas se completan una vez que llegan al final de su ejecuci\xF3n. Eso significa que esta prueba no funcionar\xE1 seg\xFAn lo previsto:</p><div class="language-js"><pre><code><span class="token keyword">import</span> fetchData <span class="token keyword">from</span> <span class="token string">&#39;@/apiService/fetchData&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// Don&#39;t do this!</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;the data is peanut butter&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#39;peanut butter&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">fetchData</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>El problema es que la prueba se completar\xE1 tan pronto como se complete <code>fetchData</code>, antes de llamar a la devoluci\xF3n de llamada.</p><p>Hay una forma alternativa de prueba que soluciona esto. En lugar de poner la prueba en una funci\xF3n con un argumento vac\xEDo, usa un solo argumento llamado <code>done</code>. As\xED se esperar\xE1 hasta que se llame el callback <code>done</code> antes de terminar la prueba.</p><div class="language-js"><pre><code><span class="token keyword">import</span> fetchData <span class="token keyword">from</span> <span class="token string">&#39;@/apiService/fetchData&#39;</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;the data is peanut butter&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">done</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>      
      <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#39;peanut butter&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">done</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">fetchData</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">30000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>Si nunca se llama a <code>done()</code>, la prueba fallar\xE1 (con un error de tiempo de espera), que es lo que desea que suceda.</p><p>Si la declaraci\xF3n de <code>expect</code> falla, arroja un error y no se llama a <code>done()</code>. Si queremos ver en el registro de prueba porqu\xE9 fall\xF3, tenemos que envolver <code>expect</code> en un bloque <code>try</code> y pasar el error en el bloque <code>catch</code> a <code>done</code>. De lo contrario, terminaremos con un error de tiempo de espera opaco que no muestra qu\xE9 valor recibi\xF3 <code>expect(data)</code>.</p><blockquote><p><strong>Nota:</strong> <code>done()</code> no debe mezclarse con Promesas, ya que esto tiende a provocar p\xE9rdidas de memoria en las pruebas.</p></blockquote><h2 id="promesas" tabindex="-1">Promesas <a class="header-anchor" href="#promesas" aria-hidden="true">#</a></h2><p>Si su c\xF3digo usa promesas, hay una forma m\xE1s sencilla de manejar las pruebas asincr\xF3nicas. Devuelve una promesa de tu prueba y se esperar\xE1 a que se resuelva esa promesa. Si se rechaza la promesa, la prueba fallar\xE1 autom\xE1ticamente.</p><p>Por ejemplo, digamos que <code>fetchData</code>, en lugar de usar una devoluci\xF3n de llamada, devuelve una promesa que se supone que debe resolverse en la cadena <code>&#39;peanut butter&#39;</code>.</p><p>Supongamos que en nuestro <em>Servicio de Api</em> - del archivo <code>src/apiService/fetchData.js</code> - llamamos a la siguiente funci\xF3n:</p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req <span class="token operator">=</span> <span class="token boolean">true</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Ready....go!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Time&#39;s up -- stop!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      req
        <span class="token operator">?</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;peanut butter&quot;</span><span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Nota:</strong> Tomemos en cuenta que para el llamado del c\xF3digo anterior usaremos el argumento <code>req</code> con el valor <code>true</code> de manera predeterminada para que la promesa sea exitosa (<code>resolve</code>). De otro modo, cuando queramos que la prueba falle (<code>reject</code>) le pasaremos el valor <code>false</code>.</p><p>Podr\xEDamos probarlo con:</p><div class="language-js"><pre><code><span class="token keyword">import</span> fetchData <span class="token keyword">from</span> <span class="token string">&#39;@/apiService/fetchData&#39;</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;the data is peanut butter&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#39;peanut butter&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Aseg\xFArese de devolver la promesa: si omite esta declaraci\xF3n de <code>return</code>, su prueba se completar\xE1 antes de que se resuelva la promesa retornada por <code>fetchData</code> y <code>then()</code> tenga la oportunidad de ejecutar la devoluci\xF3n de llamada.</p><p>Si espera que se rechace una promesa, use el m\xE9todo <code>.catch</code>. Aseg\xFArese de agregar <code>expect.assertions</code> para verificar que se llame a un cierto n\xFAmero de afirmaciones. De lo contrario, una promesa cumplida no fallar\xEDa la prueba.</p><div class="language-js"><pre><code><span class="token keyword">import</span> fetchData <span class="token keyword">from</span> <span class="token string">&#39;@/apiService/fetchData&#39;</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;the fetch fails with an error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  expect<span class="token punctuation">.</span><span class="token function">assertions</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">expect</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatch</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="resuelve-rechaza" tabindex="-1">.resuelve / .rechaza <a class="header-anchor" href="#resuelve-rechaza" aria-hidden="true">#</a></h2><p>Tambi\xE9n puede usar el comparador <code>.resolves</code> en su declaraci\xF3n de expectativa, y se esperar\xE1 a que se resuelva esa promesa. Si se rechaza la promesa, la prueba fallar\xE1 autom\xE1ticamente.</p><div class="language-js"><pre><code><span class="token keyword">import</span> fetchData <span class="token keyword">from</span> <span class="token string">&#39;@/apiService/fetchData&#39;</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;the data is peanut butter&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resolves<span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#39;peanut butter&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// or</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;the data is peanut butter&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resolves<span class="token punctuation">.</span><span class="token function">toMatch</span><span class="token punctuation">(</span><span class="token string">&#39;peanut butter&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Aseg\xFArese de retornar la afirmaci\xF3n: si omite esta declaraci\xF3n de retorno, su prueba se completar\xE1 antes de que se resuelva la promesa devuelta por <code>fetchData</code> y <code>then()</code> tenga la oportunidad de ejecutar la devoluci\xF3n de llamada.</p><p>Si espera que se rechace una promesa, use el comparador <code>.rejects</code>. Funciona de forma an\xE1loga al comparador <code>.resolves</code>. Si se cumple la promesa, la prueba fallar\xE1 autom\xE1ticamente.</p><div class="language-js"><pre><code><span class="token keyword">import</span> fetchData <span class="token keyword">from</span> <span class="token string">&#39;@/apiService/fetchData&#39;</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;the fetch fails with an error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rejects<span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// or</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;the fetch fails with an error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rejects<span class="token punctuation">.</span><span class="token function">toMatch</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="asincrono-espera" tabindex="-1">As\xEDncrono/Espera <a class="header-anchor" href="#asincrono-espera" aria-hidden="true">#</a></h2><p>Alternativamente, puede usar <code>async</code> y <code>await</code> en sus pruebas. Para escribir una prueba as\xEDncrona, use la palabra clave <code>async</code> delante de la funci\xF3n que se pas\xF3 a prueba. Por ejemplo, el mismo escenario de <code>fetchData</code> se puede probar con:</p><div class="language-js"><pre><code><span class="token keyword">import</span> fetchData <span class="token keyword">from</span> <span class="token string">&#39;@/apiService/fetchData&#39;</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;the data is peanut butter&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#39;peanut butter&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;the fetch fails with an error&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  expect<span class="token punctuation">.</span><span class="token function">assertions</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatch</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Puede combinar <code>async</code> y <code>await</code> con <code>.resolves</code> o <code>.rejects</code>.</p><div class="language-js"><pre><code><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;the data is peanut butter&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resolves<span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#39;peanut butter&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;the data is peanut butter&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resolves<span class="token punctuation">.</span><span class="token function">toMatch</span><span class="token punctuation">(</span><span class="token string">&#39;peanut butter&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;the fetch fails with an error&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rejects<span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;the fetch fails with an error&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rejects<span class="token punctuation">.</span><span class="token function">toMatch</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>En estos casos, <code>async</code> y <code>await</code> son efectivamente az\xFAcar sint\xE1ctico para la misma l\xF3gica que usa el ejemplo de promesas.</p><div class="warning custom-block"><p class="custom-block-title">PRECAUCI\xD3N</p><p>Aseg\xFArese de devolver (<code>return</code>) o esperar (<code>await</code>) la promesa - si omite la declaraci\xF3n de <code>return</code>/<code>await</code>, su prueba se completar\xE1 antes de que la promesa devuelta por <code>fetchData</code> se resuelva o rechace.</p></div><p>Ninguno de estas formas es particularmente superior a las dem\xE1s, y puede mezclarlos y combinarlos en una base de c\xF3digo o incluso en un solo archivo. Solo depende del estilo que sienta que hace que sus pruebas sean m\xE1s simples.</p>`,40),o=[e];function c(u,l,i,r,k,d){return s(),a("div",null,o)}var g=n(p,[["render",c]]);export{f as __pageData,g as default};
